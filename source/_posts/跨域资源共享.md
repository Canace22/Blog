---
title: 关于跨域那些事
categories: web
tags: web安全
description: 跨域相关笔记
comments: true
toc: true
date: 2021-03-16 08:47:29
---

## 一、同域

1995 年由 Netscape 提出同源策略。

为什么会有同源策略呢，这个问题还要说到 cookie 的设置过程，当我们登录一些购物网站或者是银行系统，服务器会带一个 set-cookie 字段，浏览器会把服务器返回的 cookie 存在本地，下一次请求会带上这个 cookie。这里钥匙网站里面有恶意链接，点击之后也设置了 cookie 的话，就意味着我们的账号被盗了，别人可以恶意操作。这就存在一个安全问题了，所以同源策略就被提出了。

浏览器遵守同源策略，在发送 Ajax 请求时，只接收同域服务器响应的数据资源。满足同域的条件包括三个：
- 协议相同
- 域名相同
- 端口相同

若不满足以上三个条件，则算作跨域。

## 二、解决跨域的方法

**1. 同域代理**

同域代理就是使用 Ajax 向同域下的后台发送请求，同时携带真实请求的地址及参数，后台接受请求后直接根据地址及参数转发请求，因为后台是可以直接模拟 HTTP 客户端发送请求的，所以没有跨域问题，而后台接受到响应数据后再原样返回给前端浏览器，从而实现跨域数据交互。

**2. jsonp**

JSONP 是利用了 script 标签的 src 属性来实现跨域数据交互的，因为浏览器解析 HTML 代码时，原生具有 src 属性的标签，浏览器都赋予其 HTTP 请求的能力，而且不受跨域限制，使用 src 发送 HTTP 请求，服务器返回一段 JS 代码的函数调用，将服务器数据放在函数实参中，前端提前写好响应的函数准备回调，接收数据，实现跨域数据交互。

**3. 跨域资源共享 CORS**

CORS 是一个 W3C 标准，全称是"跨域资源共享"（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。CORS 的关键在服务器，只要服务器实现了 CORS 接口，就可以跨源通信。CORS请求默认不发送Cookie和HTTP认证信息，若要发送可以在服务端和浏览器端分别设置。

参考文章：
[跨域资源共享 CORS 详解](https://www.ruanyifeng.com/blog/2016/04/cors.html)
[所有人都应该知道的跨域及 CORS](https://zhuanlan.zhihu.com/p/53996160)
